Hastigram.Views.Navbar = Backbone.View.extend({

  events: {
    'keyup .user-search-input': 'search',
    // 'focusout .user-search-input': 'clearSearch',
    'click .follow': 'follow'

  },

  render: function() {
    this.$el.html(this.template());
    return this;
  },

  clearSearch: function() {
    $('.search-results').html('');
  },

  follow: function() {
    payLoad = {}
    payLoad.followid = $(event.target).data('user-id');
    var that = this;
    $.ajax({
        url : "/api/follows",
        type: "POST",
        data : payLoad,
        success: function(data, textStatus, jqXHR) {
          that.clearSearch();
        },
        error: function (jqXHR, textStatus, errorThrown)
        {
          //  debugger;
        }
    });
  },

  search: function() {
    var searchCrit = $('.user-search-form').serializeJSON();
    if (searchCrit === "") {
      searchCrit = "_";
    }
    var that = this;
    $.ajax({
        url : "/api/usersearch",
        type: "POST",
        data : searchCrit,
        success: function(data, textStatus, jqXHR) {
          var $results = $('.search-results');
          $results.html('');
          for(var i = 0; i < data.length; i++) {
            $results.append($('<div>')
              .addClass('search-result-item')
              .html(that.listItem({user: data[i]})));
          }
        },
        error: function (jqXHR, textStatus, errorThrown)
        {
          //  debugger;
        }
    });
  },
  listItem: JST['listitem'],
  template: JST['navbar']
});
